<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="~{fragments/default::header}">
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Baker : 레시피 수정</title>
  <script>
    $(document).ready(function(){
      var errorMessage = [[${errorMessage}]];
      if(errorMessage != null){
        alert(errorMessage);
      }

      bindDomEvent();

    });

    function bindDomEvent(){
      $(".custom-file-input").on("change", function() {
        var fileName = $(this).val().split("\\").pop();  //이미지 파일명
        var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
        fileExt = fileExt.toLowerCase(); //소문자 변환

        if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
          alert("이미지 파일만 등록이 가능합니다.");
          return;
        }

        $(this).siblings(".custom-file-label").html(fileName);
      });
    }
  </script>
</head>
<body>
<div id="wrap">
  <div th:replace="~{role/banner::section}"></div>
  <div id="content" role="main">
      <form action="/recipe/new" class="recipe_form" th:object="${itemFormDto}" method="post" enctype="multipart/form-data">
        <!-- csrf(사이트간 위조 요청) 를 막기 위한 csrf 토큰값 -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <input type="hidden" id="item-id" th:value="${item.id}">
        <div class="write_left">
            <div class="recipe_title">
              <select class="recipe_type" id="itemType" th:field="*{itemType}">
                  <option th:each="itemType : ${T(Baker.community.constant.ItemType).values()}"
                          th:value="${itemType.name()}"
                          th:text="${itemType.name()}"></option>
              </select>
              <br>
              <input type="text" th:value="${item.itemName}" id="itemName" class="recipe_name" placeholder="레시피 이름을 입력해 주세요." maxlength="15"  required>
              <p th:if="${#fields.hasErrors('itemName')}" th:errors="*{itemName}" class="field_error"></p>
              <br>
              <input type="text" th:value="${item.info}" id="info"  class="recipe_info" placeholder="레시피를 한줄로 표현한다면? (최대 25자)" maxlength="25" required>
            </div>
          <div>
              <div class="recipe_img">
                <input type="file" class="recipeImg custom-file-label" name="itemImgFile">
            </div>
          </div>
            <div class="recipe_material">
              <label th:for="material">[ 재료 ]</label>
              <textarea th:text="${item.material}" id="material" cols="45" rows="4" maxlength="200" required></textarea>
            </div>
        </div>
        <div class="write_right">
          <div class="recipe_write">
            <label th:for="recipe">[ 레시피 ]</label>
            <textarea th:text="${item.recipe}" id="recipe" cols="45" rows="15" maxlength="500" required></textarea>
          </div>
          <div class="form_btn">
            <button th:if="${item.id} != null" type="submit" id="Modify_btn" class="modify_btn">수정</button>
            <button th:if="${item.id} == null" type="submit" id="Create_btn" class="create_btn">등록</button>
          </div>
        </div>
      </form>
  </div>
</div>
<script src="/js/recipe.js"></script>
</body>
</html>