<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="~{fragments/default::header}">
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Baker : 레시피 수정</title>
  <script>
    $(document).ready(function(){
      var errorMessage = [[${errorMessage}]];
      if(errorMessage != null){
        alert(errorMessage);
      }

      bindDomEvent();

    });

    function bindDomEvent(){
      $(".custom-file-input").on("change", function() {
        var fileName = $(this).val().split("\\").pop();  //이미지 파일명
        var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
        fileExt = fileExt.toLowerCase(); //소문자 변환

        if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
          alert("이미지 파일만 등록이 가능합니다.");
          return;
        }

        $(this).siblings(".custom-file-label").html(fileName);
      });
    }
  </script>
</head>
<body>
<div id="wrap">
  <div th:replace="~{role/banner::section}"></div>
  <div id="content" role="main">
      <form class="recipe_form" th:object="${itemFormDto}" method="post" enctype="multipart/form-data">
        <input type="hidden" id="item-id" th:field="*{id}">
        <div class="write_left">
            <div class="recipe_title">
              <select class="recipe_type" id="itemType" th:field="*{itemType}">
                <option value="BREAD">BREAD</option>
                <option value="CAKE">CAKE</option>
                <option value="COOKIE">COOKIE</option>
              </select>
              <br>
              <input type="text" th:field="*{itemName}" id="itemName" class="recipe_name" placeholder="레시피 이름을 입력해 주세요." maxlength="15">
              <p th:if="${#fields.hasErrors('itemName')}" th:errors="*{itemName}" class="field_error"></p>
              <br>
              <input type="text" th:field="*{info}" id="info"  class="recipe_info" placeholder="레시피를 한줄로 표현한다면? (최대 25자)" maxlength="25">
              <p th:if="${#fields.hasErrors('info')}" th:errors="*{info}" class="field_error"></p>
            </div>
          <div>
            <!-- 상품 이미지 리스트가 비어있다면 상품 등록 -->
            <div th:if="${#lists.isEmpty(itemFormDto.itemImgDtoList)}" class="recipe_img">
                <div class="recipeImg">
                  <input type="file" class="custom-file-input" name="itemImgFile">
                </div>
            </div>
            <!-- 상품 이미지 리스트가 존재한다면(비어있지 않다면) 상품 수정-->
            <div th:if="${not #lists.isEmpty(itemFormDto.itemImgDtoList)}">
              <div>
                <input type="file" class="custom-file-input" name="itemImgFile">
              </div>
            </div>
          </div>
            <div class="recipe_material">
              <label th:for="material">[ 재료 ]</label>
              <textarea th:field="*{material}" id="material" cols="45" rows="4" maxlength="200"></textarea>
            </div>
          <p th:if="${#fields.hasErrors('material')}" th:errors="*{material}" class="field_error"></p>
        </div>
        <div class="write_right">
          <div class="recipe_write">
            <label th:for="recipe">[ 레시피 ]</label>
            <textarea th:field="*{recipe}" id="recipe" cols="45" rows="15" maxlength="500"></textarea>
          </div>
          <p th:if="${#fields.hasErrors('recipe')}" th:errors="*{recipe}" class="field_error"></p>

          <div th:if="${#strings.isEmpty(itemFormDto.id)}">
            <button th:formaction="@{/recipe/new}" type="submit" id="Create_btn" class="create_btn">등록</button>
          </div>
          <div th:unless="${#strings.isEmpty(itemFormDto.id)}">
            <button th:formaction="@{'/recipe/new/' + ${itemFormDto.id}" type="submit" id="Modify_btn" class="modify_btn">수정</button>
          </div>
        </div>
        <!-- csrf(사이트간 위조 요청) 를 막기 위한 csrf 토큰값 -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
      </form>
  </div>
</div>
<!--<script src="/js/recipe.js"></script>-->
</body>
</html>